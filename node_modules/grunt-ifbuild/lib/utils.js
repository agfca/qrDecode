
var cleanspaceLine = module.exports.cleanspaceLine = function(content){

   var  lines  = content.match(/.*[\r\n]/g);
   content = '';
   if(typeof lines != 'undefined' && lines != null){
      lines.forEach(function(line){
         if(!/^\s*[\r\n]/.test(line)){
             content += line;
         }
      });
   }
   return content;
}

var cleancomment = module.exports.cleancomment = function(content){

   var matchs = content.match(/<!--(.|\n|\r)*?-->/ig);
    if(typeof matchs != 'undefined' && matchs != null){
      matchs.forEach(function(match){
        content = content.replace(match,'');
      });
    }
    return content;
}
var warpstr = module.exports.warpstr = function(content){

    content = cleancomment(content);
    var lines = content.split(/\n/);
    var _content = "";
    for(var i=0; i<lines.length; i++){
      var _line = lines[i].replace(/(^\s*)|(\s*$)/g,'');
      if(_line=='') continue;
      _line = _line.replace(/<\/script>/ig, "<\\\/script>");
      _content += "\n  document.write('"+_line+"');";
    }
    return _content;
  }

module.exports.wrapScript = function(content , blockType , deviceType){

    if((blockType == 'js' || blockType == 'css') && typeof deviceType !='undefined'){
       var repc = warpstr(content);
       var ret = "";
       if(repc != ""){
          var ret = '\n<script>\nif(glue.device.type =="'+deviceType+'"){';
          ret +=  repc;
          ret += "\n}\n<\/script>"
       }
       content = ret;
    }else if((blockType == 'requirejs') && typeof deviceType !='undefined'){
       content = cleancomment(content);
       var repx = /(?:[\s\S]*)<script>([\s\S]*)<\/script>/;
       content = content.replace(repx , function(match , content , offset , str){
              var ret = '\n<script>\nif(glue.device.type =="'+deviceType+'"){';
              ret += content;
              ret += "\n}\n<\/script>";
              return ret;
       });
    }
    return cleancomment(content);
}