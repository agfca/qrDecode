'use strict';

var TemplateTools = require('../lib/templateTools');
var path = require('path');
module.exports = function(grunt) {

    grunt.registerMultiTask('tpltojs', 'template file to js', function() {
    	var options = this.options();
    	var moduleName = options.moduleName;
        var basepath = options.base || '';
        this.files.forEach(function (f) {
			var fileList = f.src.filter(function (filepath) {
	            if (!grunt.file.exists(filepath)) {
	                grunt.log.warn('Source file "' + filepath + '" not found.');
	                return false;
	            } else {
	                return true;
	            }
	        });

	        var tools = new TemplateTools(options);
	        tools.compile(moduleName , fileList , basepath);
		});
    });
}